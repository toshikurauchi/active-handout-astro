---
import Button from "../../../react/components/button/Button.tsx";
import googleLogo from "./google-logo.svg";
import config from "virtual:active-handout/user-config";
import { useTranslations } from "../../../utils/translations";

const t = useTranslations(config.lang);
---

<div class="google-btn-container">
  <Button
    id="google-signin"
    colorScheme="google"
    leftImg={googleLogo.src}
    client:visible
  >
    {t("auth.signin-google")}
  </Button>
</div>

<script>
  import { GoogleAuthProvider, signInWithPopup, getAuth } from "firebase/auth";
  import { app } from "../../../firebase/client";

  const auth = getAuth(app);

  const googleSignin = document.querySelector(
    "#google-signin"
  ) as HTMLButtonElement;
  googleSignin.addEventListener("click", async () => {
    const provider = new GoogleAuthProvider();
    const userCredential = await signInWithPopup(auth, provider);
    const idToken = await userCredential.user.getIdToken();
    const res = await fetch("/api/auth/signin", {
      headers: {
        Authorization: `Bearer ${idToken}`,
      },
    });

    if (res.redirected) {
      window.location.assign(res.url);
    }
  });
</script>

<style lang="scss">
  .google-btn-container {
    display: flex;
    margin-top: 0.5em;
  }
</style>
