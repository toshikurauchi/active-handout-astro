---
import config from "virtual:active-handout/user-config";
import AuthPage from "../layout/AuthPage.astro";
import LoginForm from "../react/fragments/login/LoginForm.tsx";
import { getUserFromCookie } from "../utils/server-auth.ts";
import { useTranslations } from "../utils/translations";

const t = useTranslations(config.lang);

if (config.auth) {
  const user = await getUserFromCookie(Astro.cookies.get("session").value);
  if (user) {
    return Astro.redirect(Astro.url.searchParams.get("next") || "/");
  }
}
---

<AuthPage title={t("signin.title")}>
  <div class="form-container">
    <h1>{t("signin.title")}</h1>

    <LoginForm action="/api/auth/signin" client:visible />

    <p class="no-account">
      {t("signin.no-account")}
      <a href="/register">{t("signin.create-account")}</a>
    </p>
  </div>
</AuthPage>

<style>
  p.no-account {
    font-size: var(--fnt-sz--1);
    margin-top: 3em;
  }

  p.error-msg {
    margin-top: 0;
    color: var(--clr-error);
    font-size: var(--fnt-sz--1);

    &.hidden {
      display: none;
    }
  }
</style>
